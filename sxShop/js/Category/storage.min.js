var DBConn = function () {

    var dbName = 'jqwebsql'; //数据库名
    var version = '1.0'; //版本信息
    var description = 'jqwebsql'; //描述
    var maxSize = 1024 * 1024 * 1024; //最大值
    var dbObj = null;

    //打开数据库
    function openDB() {
        try {
            if (!dbObj) {
                dbObj = openDatabase(dbName, version, description, maxSize);
            }
        } catch (e) {
            alert("打开数据库出现未知错误： " + e);
            dbObj = null;
        }
        return dbObj;
    }

    this.getDBconn = function () {
        openDB();
        return dbObj;
    }

    this.executeSqlDefault = function (sqlStr, params, successHandler, errorHandler) {
        openDB();
        dbObj.transaction(function (tx) {
            tx.executeSql(sqlStr, params, successHandler, errorHandler);
        }, null, null);
    }

    this.executeSqlTrans = function (fun, successHandler, errorHandler) {
        openDB();
        dbObj.transaction(fun, errorHandler, successHandler);
    }

    //修改数据库版本信息
    this.changeDBVersion = function (oldVersion, newVersion) {
        dbObj = openDB();
        dbObj.changeVersion(oldVersion, newVersion, null, errorFun, null);
    }

    //判断某表是否存在：表名、存在回调函数、不存在回调函数
    this.isExitTable = function (tableName, exitFun, noexitFun) {
        dbObj = openDB();
        var sql = "select * from sqlite_master where type='table' and name = ?";
        dbObj.transaction(function (tx) {
            tx.executeSql(sql, [tableName], function (transaction, result) {
                if (result.rows.length > 0 && exitFun) {
                    exitFun.call();
                } else if (result.rows.length <= 0 && noexitFun) {
                    noexitFun.call();
                }
            }, null);
        });

    }

    //删除表数据：表名，删除成功回调函数
    this.delTbleData = function (tableName, callBackFun) {
        dbObj = openDB();
        var sql = "delete from ?";
        dbObj.transaction(function (tx) {
            tx.executeSql(sql, [tableName], callBackFun, null);
        });
    }

    //删除表，删除成功回调函数
    this.delTbleData = function (tableName, callBackFun) {
        dbObj = openDB();
        var sql = "drop table ?";
        dbObj.transaction(function (tx) {
            tx.executeSql(sql, [tableName], callBackFun, null);
        });
    }
}

var test=new DBConn();
test.openDB();
test.executeSqlDefault('select * from mytab')



// //打开数据库
// var db=openDatabase("MyDB",1,"MyDB",1000);
// //执行一个事务
// db.transaction(function(e){
//     //当mytab不存在时删除它
//     e.executeSql("drop table if exists mytab");
//     //创建一个mytab表格
//     e.executeSql("create table mytab(id unique,title)");
//     //插入三条记录
//     e.executeSql("insert into mytab(id,title) values(1,'asdf')");
//     e.executeSql("insert into mytab(id,title) values(2,'qwer')");
//     e.executeSql("insert into mytab(id,title) values(3,'zxcv')");
//     //查询
//     e.executeSql("select * from mytab",null,function(e,s){
//         //查询成功回到函数
//         //遍历记录集，并输出到控制台
//         var i=0,s=s.rows,l=s.length;
//         while(i<l)console.log(s.item(i++));
//     });
// });